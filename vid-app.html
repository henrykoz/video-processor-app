<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video to B&W Converter</title>
    <style>
        #videoContainer, #canvasContainer {
            display: inline-block;
            margin: 10px;
        }
        #controls {
            margin: 10px;
        }
    </style>
</head>
<body>
    <div id="videoContainer">
        <video id="videoInput" width="640" height="480" controls>
            Your browser does not support the video tag.
        </video>
    </div>
    <div id="canvasContainer">
        <canvas id="outputCanvas" width="640" height="480"></canvas>
    </div>
    <br>
    <input type="file" id="fileInput" accept="video/*">
    <div id="controls">
        <label>
            <input type="checkbox" id="bwCheckbox"> Apply Black & White Filter
        </label>
    </div>

    <script>
        const video = document.getElementById('videoInput');
        const canvas = document.getElementById('outputCanvas');
        const ctx = canvas.getContext('2d');
        const fileInput = document.getElementById('fileInput');
        const bwCheckbox = document.getElementById('bwCheckbox');

        let isBlackAndWhite = false;

        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            const fileURL = URL.createObjectURL(file);
            video.src = fileURL;
        });

        bwCheckbox.addEventListener('change', function() {
            isBlackAndWhite = this.checked;
        });

        function toBlackAndWhite(imageData) {
            const data = imageData.data;
            for (let i = 0; i < data.length; i += 4) {
                const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                data[i] = data[i + 1] = data[i + 2] = avg;
            }
            return imageData;
        }

        function processFrame(imageData) {
            if (isBlackAndWhite) {
                return toBlackAndWhite(imageData);
            }
            return imageData;
        }

        function processVideo() {
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            
            let processedImageData = processFrame(imageData);
            
            ctx.putImageData(processedImageData, 0, 0);
            
            requestAnimationFrame(processVideo);
        }

        video.addEventListener('play', processVideo);
    </script>
</body>
</html>